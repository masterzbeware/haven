--[[ üìå AUTO ACCEPT VISITOR MILIK SENDIRI ‚Äì DELTA EXECUTOR VERSION
     - Cek owner NPC == UserId sendiri
     - Tidak accept jika counter visitor sudah 25/25
--]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local PromptEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("NpcAcceptPromptTriggered")

-- Ganti ini sesuai user ID kamu
local MY_USER_ID = 8684717800
local acceptedIds = {}

-- Fungsi: Cek apakah plot sudah penuh (Counter.Text = 25/25)
local function isVisitorFull()
	local plots = Workspace:FindFirstChild("Plots")
	if not plots then return true end

	for _, plot in ipairs(plots:GetChildren()) do
		if plot:IsA("Part") and plot:GetAttribute("Owner") == MY_USER_ID then
			local sign = plot:FindFirstChild("Sign")
			if sign then
				local signFace = sign:FindFirstChild("SignFace")
				if signFace then
					local gui = signFace:FindFirstChildWhichIsA("SurfaceGui")
					if gui then
						local visitors = gui:FindFirstChild("Visitors")
						if visitors and visitors:IsA("TextLabel") then
							local counter = visitors:FindFirstChild("Counter")
							if counter and counter:IsA("TextLabel") then
								local current, max = string.match(counter.Text, "(%d+)/(%d+)")
								current, max = tonumber(current), tonumber(max)
								if current and max and current >= max then
									return true
								end
							end
						end
					end
				end
			end
		end
	end
	return false
end

-- Fungsi: Accept visitor jika milik sendiri dan belum penuh
local function acceptVisitor(npc)
	if npc:IsA("Model") and npc.Name:match("^visitor_%d+") then
		local owner = npc:GetAttribute("Owner")
		local id = npc:GetAttribute("Id")
		if owner == MY_USER_ID and typeof(id) == "string" and not acceptedIds[id] and id:match("^%b{}$") then
			if isVisitorFull() then
				warn("‚ùå Visitor penuh. Melewati:", npc.Name)
				return
			end
			acceptedIds[id] = true
			PromptEvent:FireServer(id)
			print("‚úÖ Accepted NPC:", id)
		end
	end
end

-- Loop terus-menerus cek NPC baru
while true do
	for _, npc in ipairs(Workspace:GetChildren()) do
		acceptVisitor(npc)
	end
	wait(0.2) -- Jangan terlalu spam, bisa kamu ubah jadi 1-2 detik 
end
